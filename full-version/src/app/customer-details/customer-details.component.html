<ng-template #accessDenied>
  <div class="data text-danger">(No Permission)</div>
</ng-template>

<ng-template #noImageUploaded>
  <div class="col-12 col-lg-3">
    <img
      src="https://png.pngtree.com/png-vector/20221125/ourmid/pngtree-no-image-available-icon-flatvector-illustration-pic-design-profile-vector-png-image_40966566.jpg"
      alt="salarySlip"
    />
  </div>
</ng-template>

<ng-template #noURL>
  <data href="" class="text-danger">No URL</data>
</ng-template>

<div class="row">
  <button type="button" class="col-2 btn-sm btn-primary" backButton>
    go back
  </button>
  <!-- <app-gobackbutton style="display: block"></app-gobackbutton> -->
  <div class="col-1"></div>
  <a
    routerLink="/tables/customerDetails/{{ customer.id }}/edit"
    class="col-2 btn btn-sm btn-primary px-3 py-1"
    *ngIf="httpService.role == 'SUPERADMIN'"
    >Edit</a
  >
  <div class="col-7"></div>
</div>

<!-- Media object starts -->

<section class="users-edit">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-content">
          <div class="card-body">
            <!-- Nav-tabs -->
            <ul
              ngbNav
              #nav="ngbNav"
              [activeId]="1"
              class="nav-tabs justify-content-left"
            >
              <li [ngbNavItem]="1">
                <a ngbNavLink class="nav-link d-flex align-items-center">
                  <i class="ft-user mr-1"></i>
                  <span class="d-none d-sm-block">Personal Details</span>
                </a>
                <ng-template ngbNavContent>
                  <!-- Account content starts -->
                  <div class="mt-2" id="Personal">
                    <!-- Media object starts -->
                    <div class="row">
                      <div class="col-12 col-sm-7">
                        <div class="media d-flex align-items-center">
                          <img
                            src="{{
                              httpService.getFile(customer.icImagePath)
                            }}"
                            alt="IC"
                          />
                        </div>
                      </div>
                    </div>
                    <!-- Media object ends -->

                    <!-- Account form starts -->
                    <div>
                      <div class="row">
                        <div class="col-12">
                          <div class="row">
                            <div class="col">
                              <label class="h4">Name :</label>
                              <div class="data">{{ customer.name }}</div>
                            </div>
                            <div class="col">
                              <label class="h4">IC :</label>
                              <div class="data">{{ customer.ic }}</div>
                            </div>
                          </div>

                          <br />

                          <div class="row">
                            <div class="col">
                              <label class="h4">Phone Number :</label>
                              <div
                                class="data"
                                *ngIf="
                                  httpService.role == 'SUPERADMIN' ||
                                    httpService.role == 'COLLECTOR';
                                  else accessDenied
                                "
                              >
                                {{ customer.phoneNumber }}
                              </div>
                            </div>

                            <div class="col">
                              <label class="h4">Car Plate Number :</label>
                              <div class="data">{{ customer.phoneNumber }}</div>
                            </div>
                          </div>

                          <hr />

                          <div class="row">
                            <div class="col">
                              <label class="h4">Occupation:</label>
                              <div class="data">{{ customer.occupation }}</div>
                            </div>
                            <div class="col">
                              <label class="h4">Salary:</label>
                              <div class="data">{{ customer.salary }}</div>
                            </div>
                          </div>
                          <hr />
                          <label class="h4">Salary Slip:</label>
                          <br />
                          <div
                            class="row"
                            *ngIf="
                              httpService.role == 'SUPERADMIN' ||
                                httpService.role == 'COLLECTOR' ||
                                httpService.role == 'ADMIN2';
                              else accessDenied
                            "
                          >
                            <div class="col-12 col-lg-3">
                              <img
                                *ngIf="
                                  customer.salarySlipImagePath;
                                  else noImageUploaded
                                "
                                src="{{
                                  httpService.getFile(
                                    customer.salarySlipImagePath
                                  )
                                }}"
                                alt="salarySlip"
                              />
                            </div>
                          </div>
                          <hr />
                        </div>
                      </div>
                    </div>
                    <!-- Account form ends -->
                  </div>
                  <!-- Account content ends -->
                </ng-template>
              </li>
              <li
                [ngbNavItem]="2"
                *ngIf="
                  httpService.role == 'SUPERADMIN' ||
                  httpService.role == 'COLLECTOR' ||
                  httpService.role == 'ADMIN2'
                "
              >
                <a ngbNavLink class="nav-link d-flex align-items-center">
                  <i class="icon-home mr-1"></i>
                  <span class="d-none d-sm-block">Home</span>
                </a>
                <ng-template ngbNavContent>
                  <!-- Account content starts -->
                  <div class="mt-2" id="Information">
                    <!-- Media object starts -->
                    <label class="h4">Home:</label>
                    <br />
                    <div class="row">
                      <div class="col-12 col-lg-3">
                        <img
                          *ngIf="
                            customer.homeAddressImagePath;
                            else noImageUploaded
                          "
                          src="{{
                            httpService.getFile(customer.homeAddressImagePath)
                          }}"
                          alt="home"
                        />
                      </div>

                      <label class="h4">Google Map:</label>
                      <div class="col-12 col-lg-3">
                        <a
                          class="text-info data"
                          href="{{ customer.homeAddressGoogleMapsUrl }}"
                        >
                          Home Address
                        </a>
                      </div>
                    </div>
                    <br />
                    <div class="row">
                      <label class="h4">Water Bill:</label>
                      <div class="col-12 col-lg-3">
                        <img
                          *ngIf="
                            customer.waterUtilityBillImagePath;
                            else noImageUploaded
                          "
                          src="{{
                            httpService.getFile(
                              customer.waterUtilityBillImagePath
                            )
                          }}"
                          alt="waterBill"
                        />
                      </div>

                      <label class="h4">Electric Bill:</label>
                      <div class="col-12 col-lg-3">
                        <img
                          *ngIf="
                            customer.electricUtilityBillImagePath;
                            else noImageUploaded
                          "
                          src="{{
                            httpService.getFile(
                              customer.electricUtilityBillImagePath
                            )
                          }}"
                          alt="electricBill"
                        />
                      </div>
                    </div>
                    <hr />
                  </div>
                </ng-template>
              </li>
              <li
                [ngbNavItem]="3"
                *ngIf="
                  httpService.role == 'SUPERADMIN' ||
                  httpService.role == 'COLLECTOR' ||
                  httpService.role == 'ADMIN2'
                "
              >
                <a ngbNavLink class="nav-link d-flex align-items-center">
                  <i class="icon-briefcase mr-1"></i>
                  <span class="d-none d-sm-block">Company</span>
                </a>
                <ng-template ngbNavContent>
                  <div class="mt-2" id="Office">
                    <div class="row">
                      <div class="col">
                        <label class="h4">Company Name:</label>
                        <div class="data">{{ customer.companyName }}</div>
                      </div>
                    </div>
                    <br />
                    <label class="h4">Office:</label>
                    <br />
                    <div class="row">
                      <div class="col-12 col-lg-3">
                        <img
                          *ngIf="
                            customer.officeLocationImagePath;
                            else noImageUploaded
                          "
                          src="{{
                            httpService.getFile(
                              customer.officeLocationImagePath
                            )
                          }}"
                          alt="office"
                        />
                      </div>

                      <label class="h4">Office Location:</label>
                      <div class="col-12 col-lg-3">
                        <a
                          *ngIf="
                            customer.officeLocationGoogleMapsUrl;
                            else noURL
                          "
                          class="text-info data"
                          href="{{ customer.officeLocationGoogleMapsUrl }}"
                        >
                          Office Address
                        </a>
                      </div>
                    </div>
                  </div>
                </ng-template>
              </li>
              <li
                [ngbNavItem]="4"
                *ngIf="
                  httpService.role == 'SUPERADMIN' ||
                  httpService.role == 'COLLECTOR'
                "
              >
                <a ngbNavLink class="nav-link d-flex align-items-center">
                  <i class="ft-alert-circle mr-1"></i>
                  <span class="d-none d-sm-block">Emergency Contact</span>
                </a>
                <ng-template ngbNavContent>
                  <!-- Account content starts -->
                  <div class="mt-2" id="Emergency Contact">
                    <div class="row">
                      <div class="col">
                        <label class="h4">Emergency Contact 1 Name :</label>
                        <div class="data">
                          {{ customer.emergencyContactName }}
                        </div>
                      </div>
                      <div class="col">
                        <label class="h4">Emergency Contact 1 Phone :</label>
                        <div class="data">
                          {{ customer.emergencyContactNumber }}
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="mt-2" id="Emergency Contact 2">
                    <div class="row">
                      <div class="col">
                        <label class="h4">Emergency Contact 2 Name :</label>
                        <div class="data">
                          {{ customer.emergencyContactName2 }}
                        </div>
                      </div>
                      <div class="col">
                        <label class="h4">Emergency Contact 2 Phone :</label>
                        <div class="data">
                          {{ customer.emergencyContactNumber2 }}
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="mt-2" id="Emergency Contact 3">
                    <div class="row">
                      <div class="col">
                        <label class="h4">Emergency Contact 3 Name :</label>
                        <div class="data">
                          {{ customer.emergencyContactName3 }}
                        </div>
                      </div>
                      <div class="col">
                        <label class="h4">Emergency Contact 3 Phone :</label>
                        <div class="data">
                          {{ customer.emergencyContactNumber3 }}
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="mt-2" id="Emergency Contact 4">
                    <div class="row">
                      <div class="col">
                        <label class="h4">Emergency Contact 4 Name :</label>
                        <div class="data">
                          {{ customer.emergencyContactName4 }}
                        </div>
                      </div>
                      <div class="col">
                        <label class="h4">Emergency Contact 4 Phone :</label>
                        <div class="data">
                          {{ customer.emergencyContactNumber4 }}
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="mt-2" id="Emergency Contact 5">
                    <div class="row">
                      <div class="col">
                        <label class="h4">Emergency Contact 5 Name :</label>
                        <div class="data">
                          {{ customer.emergencyContactName5 }}
                        </div>
                      </div>
                      <div class="col">
                        <label class="h4">Emergency Contact 5 Phone :</label>
                        <div class="data">
                          {{ customer.emergencyContactNumber5 }}
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-template>
              </li>
              <li [ngbNavItem]="5">
                <a ngbNavLink class="nav-link d-flex align-items-center">
                  <i class="ft-credit-card mr-1"></i>
                  <span class="d-none d-sm-block">Loans</span>
                </a>
                <ng-template ngbNavContent>
                  <div class="col-12">
                    <div class="card">
                      <div class="card-header d-flex">
                        <h4 class="card-title">Loans List</h4>
                      </div>
                      <div class="card-content table-responsive">
                        <div class="card-body">
                          <ngx-datatable
                            class="bootstrap core-bootstrap"
                            [rows]="loans"
                            [rowHeight]="'auto'"
                            [limit]="itemsPerpage"
                            [columnMode]="ColumnMode.force"
                            [headerHeight]="50"
                            [footerHeight]="50"
                            [scrollbarH]="true"
                            [style.font-size]="'max(1.2vw, 12px)'"
                            [selected]="chkBoxSelected"
                            selectionType="checkbox"
                            (select)="customChkboxOnSelect($event)"
                          >
                            <ngx-datatable-column
                              [width]="50"
                              [sortable]="false"
                              [canAutoResize]="false"
                              [draggable]="false"
                              [resizeable]="false"
                              *ngIf="httpService.role == 'SUPERADMIN'"
                            >
                              <ng-template
                                ngx-datatable-header-template
                                let-value="value"
                                let-allRowsSelected="allRowsSelected"
                                let-selectFn="selectFn"
                              >
                                <div class="custom-control custom-checkbox">
                                  <input
                                    type="checkbox"
                                    [checked]="allRowsSelected"
                                    (change)="selectFn(!allRowsSelected)"
                                  />
                                </div>
                              </ng-template>
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                let-isSelected="isSelected"
                                let-onCheckboxChangeFn="onCheckboxChangeFn"
                              >
                                <div class="custom-control custom-checkbox">
                                  <input
                                    type="checkbox"
                                    [checked]="isSelected"
                                    (change)="onCheckboxChangeFn($event)"
                                  />
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column
                              name="Action"
                              prop="id"
                              [width]="150"
                              *ngIf="httpService.role == 'SUPERADMIN'"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <a>
                                      <i
                                        class="icon-hourglass fa-lg text-warning mr-2"
                                        (click)="extendRepayment(row, content)"
                                      ></i>
                                    </a>

                                    <a>
                                      <i
                                        class="ft-delete fa-lg text-danger mr-2"
                                        (click)="deleteLoan(row, deleteModal)"
                                      ></i>
                                    </a>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column
                              name="Customer Name"
                              prop="id"
                              [width]="300"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <!-- *ngIf="
                          ['SUPERADMIN', 'COLLECTOR'].includes(
                            httpService.role
                          );
                          else notSuperAdmin
                        " -->
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <a
                                      routerLink="/tables/customerDetails/{{
                                        customer.id
                                      }}"
                                      class="text-info"
                                    >
                                      {{ customer.name }}
                                    </a>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column
                              name="Package Name"
                              prop="id"
                              [width]="250"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <a
                                      routerLink="/tables/loanDetails/{{
                                        row.id
                                      }}"
                                      class="text-info"
                                      *ngIf="
                                        ['SUPERADMIN', 'COLLECTOR'].includes(
                                          httpService.role
                                        );
                                        else notSuperAdmin
                                      "
                                    >
                                      {{ row.name }}
                                    </a>

                                    <ng-template #notSuperAdmin>
                                      <p>{{ row.name }}</p>
                                    </ng-template>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column
                              name="Agent Name"
                              prop="id"
                              [width]="250"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <a
                                      *ngIf="
                                        httpService.role == 'SUPERADMIN' ||
                                          httpService.role == 'COLLECTOR';
                                        else accessDenied
                                      "
                                      routerLink="/tables/user/{{
                                        customer.user.id
                                      }}/edit"
                                    >
                                      {{ customer.user.name }}
                                    </a>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column
                              name="Application Date"
                              prop="id"
                              [width]="200"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <p>
                                      {{ row.loanApplicationDate | date }}
                                    </p>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <!-- <ngx-datatable-column
                              [width]="50"
                              [sortable]="false"
                              [canAutoResize]="false"
                              [draggable]="false"
                              [resizeable]="false"
                              *ngIf="httpService.role == 'SUPERADMIN'"
                            >
                              <ng-template
                                ngx-datatable-header-template
                                let-value="value"
                                let-allRowsSelected="allRowsSelected"
                                let-selectFn="selectFn"
                              >
                                <div class="custom-control custom-checkbox">
                                  <input
                                    type="checkbox"
                                    [checked]="allRowsSelected"
                                    (change)="selectFn(!allRowsSelected)"
                                  />
                                </div>
                              </ng-template>
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                let-isSelected="isSelected"
                                let-onCheckboxChangeFn="onCheckboxChangeFn"
                              >
                                <div class="custom-control custom-checkbox">
                                  <input
                                    type="checkbox"
                                    [checked]="isSelected"
                                    (change)="onCheckboxChangeFn($event)"
                                  />
                                </div>
                              </ng-template>
                            </ngx-datatable-column> -->

                            <!-- <ngx-datatable-column
                              name="Action"
                              prop="id"
                              [width]="150"
                              *ngIf="httpService.role == 'SUPERADMIN'"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <a
                                      routerLink="/tables/loanDetails/{{
                                        row.id
                                      }}"
                                    >
                                      <i
                                        class="icon-hourglass fa-lg text-warning mr-2"
                                      ></i>
                                    </a>

<a>
                                      <i
                                        class="ft-delete fa-lg text-danger mr-2"
                                        (click)="deleteLoan(row, deleteModal)"
                                      ></i>
                                    </a>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column
                              name="Package Name"
                              prop="id"
                              [width]="250"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <a
                                      routerLink="/tables/loanDetails/{{
                                        row.id
                                      }}"
                                      class="text-info"
                                      *ngIf="
                                        ['SUPERADMIN', 'COLLECTOR'].includes(
                                          httpService.role
                                        );
                                        else notSuperAdmin
                                      "
                                    >
                                      {{ row.name }}
                                    </a>

                                    <ng-template #notSuperAdmin>
                                      <p>{{ row.name }}</p>
                                    </ng-template>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column
                              name="Loaned Amount"
                              prop="id"
                              [width]="200"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <p>
                                      {{ row.loanedAmount }}
                                    </p>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column
                              name="Next Repayment Date"
                              prop="id"
                              [width]="300"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div
                                    *ngIf="
                                      row.repayments[0];
                                      else fullyPaidTemplate
                                    "
                                    class="cell-line-height"
                                  >
                                    <p>
                                      {{
                                        row.repayments[0].targetRepaymentDate
                                          | date
                                      }}
                                    </p>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>
                            <ngx-datatable-column
                              name="Next Repayment Amount"
                              prop="id"
                              [width]="300"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div
                                    *ngIf="
                                      row.repayments[0];
                                      else fullyPaidTemplate
                                    "
                                    class="cell-line-height"
                                  >
                                    <p>
                                      {{ row.repayments[0].repaymentAmount }}
                                    </p>
                                  </div>
                                  <ng-template #fullyPaidTemplate
                                    ><div
                                      *ngIf="
                                        row.repayments;
                                        else fullyPaidTemplate
                                      "
                                      class="cell-line-height"
                                      style="background-color: greenyellow"
                                    >
                                      <p>Fully paid</p>
                                    </div></ng-template
                                  >
                                </div>
                              </ng-template>
                            </ngx-datatable-column>
                            <ngx-datatable-column
                              name="Repayment Start Date"
                              prop="id"
                              [width]="300"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <p>
                                      {{ row.loanApplicationDate | date }}
                                    </p>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column
                              name="Repayment Frequency"
                              prop="id"
                              [width]="200"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <p>
                                      {{ row.loanRepaymentFrequency }}
                                    </p>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column
                              name="Repayment Amount"
                              prop="id"
                              [width]="300"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <p>
                                      {{ row.loanSingleRepaymentAmount }}
                                    </p>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column
                              name="Repayment Total Count"
                              prop="id"
                              [width]="300"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <p>
                                      {{ row.loanRepaymentTotalCount }}
                                    </p>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column>
                            <ngx-datatable-column
                              name="ID"
                              prop="id"
                              [width]="80"
                            >
                              <ng-template
                                let-row="row"
                                let-name="value"
                                ngx-datatable-cell-template
                                class="row"
                              >
                                <div class="d-flex align-items-center">
                                  <div class="cell-line-height">
                                    <p>
                                      {{ row.id }}
                                    </p>
                                  </div>
                                </div>
                              </ng-template>
                            </ngx-datatable-column> -->
                          </ngx-datatable>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-template>
              </li>
            </ul>
            <div class="tab-content">
              <div [ngbNavOutlet]="nav"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
